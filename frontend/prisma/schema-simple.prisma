// 简化版schema，仅用于解决登录问题
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum PreferredSystem {
  HUMAN
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
  SUPER_ADMIN
}

enum MemorialType {
  HUMAN
}

enum MemorialStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// 用户表
model User {
  id                String   @id @default(cuid())
  email             String   @unique
  name              String
  passwordHash      String?
  preferredSystem   PreferredSystem?
  role              UserRole @default(USER)
  isActive          Boolean  @default(true)
  isBanned          Boolean  @default(false)
  provider          String?
  providerId        String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  lastLoginAt       DateTime @default(now())
  
  memorials         Memorial[]
  
  @@unique([provider, providerId])
  @@map("users")
}

// 纪念表
model Memorial {
  id              String        @id @default(cuid())
  title           String
  slug            String        @unique
  type            MemorialType
  subjectName     String
  birthDate       DateTime?
  deathDate       DateTime?
  age             String?
  gender          String?
  relationship    String?
  occupation      String?
  location        String?
  story           String?
  memories        String?
  status          MemorialStatus @default(PUBLISHED)
  isPublic        Boolean       @default(true)
  creatorName     String
  creatorEmail    String?
  creatorPhone    String?
  creatorRelation String?
  viewCount       Int           @default(0)
  candleCount     Int           @default(0)
  messageCount    Int           @default(0)
  likeCount       Int           @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // 外键
  authorId        String
  author          User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  @@map("memorials")
}