<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>问答式纪念表单 - 永念</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .message {
            animation: fadeInUp 0.5s ease-out;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator {
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .option-button {
            border: 1px solid #e5e7eb;
            background: white;
            transition: all 0.2s ease;
        }
        .option-button:hover {
            border-color: #000;
            background: #f9fafb;
        }
        .option-button.selected {
            border-color: #000;
            background: #000;
            color: white;
        }
        .input-clean {
            border: none;
            border-bottom: 1px solid #e5e7eb;
            background: transparent;
            outline: none;
            font-size: 18px;
            padding: 12px 0;
        }
        .input-clean:focus {
            border-bottom-color: #000;
        }
        .progress-dots {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }
        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }
        .progress-dot.active {
            background: #000;
        }
        .chat-input {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 20px;
        }
        .chat-messages {
            padding-bottom: 100px;
        }
    </style>
</head>
<body class="bg-white min-h-screen">
    <!-- 进度指示器 -->
    <div class="progress-dots">
        <div class="progress-dot active"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
    </div>

    <!-- 对话区域 -->
    <div class="chat-messages max-w-2xl mx-auto px-6 py-12" id="messages">
        <!-- 初始欢迎消息 -->
        <div class="message mb-8">
            <div class="text-sm text-gray-400 mb-2">永念</div>
            <div class="text-lg text-gray-900 leading-relaxed">
                你好，我来帮你为珍爱的它创建一个纪念页面。
            </div>
        </div>
        
        <div class="message mb-8">
            <div class="text-sm text-gray-400 mb-2">永念</div>
            <div class="text-lg text-gray-900 leading-relaxed">
                请告诉我，它叫什么名字？
            </div>
        </div>
    </div>

    <!-- 输入区域 -->
    <div class="chat-input">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-4">
                <input 
                    type="text" 
                    placeholder="输入名字..." 
                    class="input-clean flex-1"
                    id="currentInput"
                    autocomplete="off"
                />
                <button 
                    class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors disabled:bg-gray-300" 
                    onclick="submitAnswer()"
                    id="submitBtn"
                >
                    确定
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let answers = {};
        let isProcessing = false;

        const questions = [
            {
                id: 'petName',
                type: 'text',
                question: '请告诉我，它叫什么名字？',
                placeholder: '输入名字...',
                validation: (value) => value.trim().length > 0
            },
            {
                id: 'petType',
                type: 'options',
                question: `很好听的名字！${getCurrentAnswer('petName')}是什么动物呢？`,
                options: [
                    { value: 'dog', label: '狗狗 🐕' },
                    { value: 'cat', label: '猫咪 🐱' },
                    { value: 'bird', label: '鸟儿 🐦' },
                    { value: 'rabbit', label: '兔子 🐰' },
                    { value: 'hamster', label: '仓鼠 🐹' },
                    { value: 'other', label: '其他' }
                ]
            },
            {
                id: 'breed',
                type: 'text',
                question: `是什么品种的${getAnimalName()}呢？`,
                placeholder: '例如：金毛、英短、虎皮鹦鹉...',
                optional: true
            },
            {
                id: 'color',
                type: 'options',
                question: `${getCurrentAnswer('petName')}是什么颜色的？`,
                options: [
                    { value: 'black', label: '黑色' },
                    { value: 'white', label: '白色' },
                    { value: 'brown', label: '棕色' },
                    { value: 'gray', label: '灰色' },
                    { value: 'black-white', label: '黑白色' },
                    { value: 'multicolor', label: '多色' }
                ]
            },
            {
                id: 'gender',
                type: 'options',
                question: `${getCurrentAnswer('petName')}是男孩还是女孩？`,
                options: [
                    { value: 'male', label: '男孩 ♂' },
                    { value: 'female', label: '女孩 ♀' }
                ]
            },
            {
                id: 'birthDate',
                type: 'date',
                question: `${getCurrentAnswer('petName')}是什么时候出生的？`,
                placeholder: '大概时间就可以...'
            },
            {
                id: 'passingDate',
                type: 'date',
                question: '它是什么时候离开你的？'
            },
            {
                id: 'personality',
                type: 'multiple',
                question: `描述一下${getCurrentAnswer('petName')}的性格特点吧`,
                options: [
                    { value: 'playful', label: '顽皮 🎾' },
                    { value: 'loyal', label: '忠诚 ❤️' },
                    { value: 'gentle', label: '温柔 🕊️' },
                    { value: 'energetic', label: '活跃 ⚡' },
                    { value: 'calm', label: '安静 😌' },
                    { value: 'friendly', label: '友好 😊' }
                ]
            },
            {
                id: 'memory',
                type: 'textarea',
                question: `最后，分享一个关于${getCurrentAnswer('petName')}的特别回忆吧`,
                placeholder: '写下你们之间最珍贵的回忆...',
                optional: true
            },
            {
                id: 'creator',
                type: 'text',
                question: '请告诉我你的名字，这样我就知道是谁创建了这个纪念页面',
                placeholder: '你的名字...'
            }
        ];

        function getCurrentAnswer(key) {
            return answers[key] || '';
        }

        function getAnimalName() {
            const petType = answers.petType;
            const typeMap = {
                'dog': '狗狗',
                'cat': '猫咪',
                'bird': '鸟儿',
                'rabbit': '兔子',
                'hamster': '仓鼠',
                'other': '宠物'
            };
            return typeMap[petType] || '宠物';
        }

        function addMessage(sender, content, delay = 0) {
            setTimeout(() => {
                const messagesContainer = document.getElementById('messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message mb-8';
                messageDiv.innerHTML = `
                    <div class="text-sm text-gray-400 mb-2">${sender}</div>
                    <div class="text-lg text-gray-900 leading-relaxed">${content}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, delay);
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message mb-8 typing-indicator';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="text-sm text-gray-400 mb-2">永念</div>
                <div class="text-lg text-gray-500">正在输入...</div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typing');
            if (typing) {
                typing.remove();
            }
        }

        function setupInput(question) {
            const inputContainer = document.querySelector('.chat-input .max-w-2xl');
            
            if (question.type === 'text' || question.type === 'date') {
                inputContainer.innerHTML = `
                    <div class="flex items-center gap-4">
                        <input 
                            type="${question.type === 'date' ? 'date' : 'text'}" 
                            placeholder="${question.placeholder || ''}" 
                            class="input-clean flex-1"
                            id="currentInput"
                            autocomplete="off"
                        />
                        <button 
                            class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors disabled:bg-gray-300" 
                            onclick="submitAnswer()"
                            id="submitBtn"
                        >
                            确定
                        </button>
                    </div>
                `;
            } else if (question.type === 'textarea') {
                inputContainer.innerHTML = `
                    <div class="space-y-4">
                        <textarea 
                            placeholder="${question.placeholder || ''}" 
                            class="w-full border-0 border-b border-gray-200 bg-transparent outline-none resize-none p-0 text-lg focus:border-black"
                            rows="3"
                            id="currentInput"
                        ></textarea>
                        <div class="flex justify-end gap-3">
                            ${question.optional ? '<button class="text-gray-500 text-sm hover:text-gray-700" onclick="skipQuestion()">跳过</button>' : ''}
                            <button 
                                class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors" 
                                onclick="submitAnswer()"
                                id="submitBtn"
                            >
                                确定
                            </button>
                        </div>
                    </div>
                `;
            } else if (question.type === 'options' || question.type === 'multiple') {
                const buttonsHtml = question.options.map(option => `
                    <button 
                        class="option-button p-4 text-left w-full mb-3 ${question.type === 'multiple' ? 'multiple-option' : ''}" 
                        data-value="${option.value}"
                        onclick="${question.type === 'multiple' ? 'toggleMultipleOption' : 'selectOption'}(this)"
                    >
                        ${option.label}
                    </button>
                `).join('');
                
                inputContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="grid gap-2">
                            ${buttonsHtml}
                        </div>
                        ${question.type === 'multiple' ? `
                            <div class="flex justify-end">
                                <button 
                                    class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors" 
                                    onclick="submitMultipleAnswer()"
                                    id="submitBtn"
                                >
                                    确定
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // 自动聚焦输入框
            setTimeout(() => {
                const input = document.getElementById('currentInput');
                if (input && input.focus) {
                    input.focus();
                }
            }, 100);

            // 回车提交
            document.addEventListener('keypress', handleEnterKey);
        }

        function handleEnterKey(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                submitAnswer();
            }
        }

        function selectOption(button) {
            // 清除其他选项的选中状态
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // 选中当前选项
            button.classList.add('selected');
            
            // 延迟提交，让用户看到选中效果
            setTimeout(() => {
                answers[questions[currentQuestion].id] = button.dataset.value;
                nextQuestion();
            }, 300);
        }

        function toggleMultipleOption(button) {
            button.classList.toggle('selected');
        }

        function submitMultipleAnswer() {
            const selectedOptions = Array.from(document.querySelectorAll('.multiple-option.selected'))
                .map(btn => btn.dataset.value);
            
            if (selectedOptions.length === 0) {
                alert('请至少选择一个选项');
                return;
            }
            
            answers[questions[currentQuestion].id] = selectedOptions;
            nextQuestion();
        }

        function submitAnswer() {
            if (isProcessing) return;
            
            const input = document.getElementById('currentInput');
            const value = input ? input.value.trim() : '';
            const question = questions[currentQuestion];
            
            if (!question.optional && (!value || value === '')) {
                alert('请填写必填信息');
                return;
            }
            
            if (question.validation && !question.validation(value)) {
                alert('请输入有效信息');
                return;
            }
            
            answers[question.id] = value;
            
            // 显示用户的回答
            addMessage('你', value || '(跳过)');
            
            nextQuestion();
        }

        function skipQuestion() {
            answers[questions[currentQuestion].id] = '';
            addMessage('你', '(跳过)');
            nextQuestion();
        }

        function nextQuestion() {
            if (isProcessing) return;
            isProcessing = true;
            
            // 移除输入事件监听
            document.removeEventListener('keypress', handleEnterKey);
            
            currentQuestion++;
            
            // 更新进度点
            const dots = document.querySelectorAll('.progress-dot');
            if (dots[Math.floor(currentQuestion / 2)]) {
                dots[Math.floor(currentQuestion / 2)].classList.add('active');
            }
            
            if (currentQuestion >= questions.length) {
                // 完成所有问题
                showCompletion();
                return;
            }
            
            // 显示正在输入指示器
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const question = questions[currentQuestion];
                let questionText = question.question;
                
                // 动态替换问题中的变量
                questionText = questionText.replace(/\$\{getCurrentAnswer\('(\w+)'\)\}/g, (match, key) => {
                    return getCurrentAnswer(key);
                });
                questionText = questionText.replace(/\$\{getAnimalName\(\)\}/g, getAnimalName());
                
                addMessage('永念', questionText);
                
                setTimeout(() => {
                    setupInput(question);
                    isProcessing = false;
                }, 500);
            }, 1000);
        }

        function showCompletion() {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('永念', `谢谢你分享关于${getCurrentAnswer('petName')}的美好回忆。`);
                
                setTimeout(() => {
                    addMessage('永念', '现在我将为你创建这个特别的纪念页面...');
                    
                    // 隐藏输入区域
                    document.querySelector('.chat-input').style.display = 'none';
                    
                    setTimeout(() => {
                        // 显示完成页面或提交表单
                        console.log('收集到的信息：', answers);
                        alert('纪念页面创建完成！\n\n收集到的信息已在控制台显示。');
                    }, 2000);
                }, 1500);
            }, 1000);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            setupInput(questions[0]);
        });
    </script>
</body>
</html>