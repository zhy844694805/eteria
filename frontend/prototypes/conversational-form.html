<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®ç­”å¼çºªå¿µè¡¨å• - æ°¸å¿µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .message {
            animation: fadeInUp 0.5s ease-out;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator {
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .option-button {
            border: 1px solid #e5e7eb;
            background: white;
            transition: all 0.2s ease;
        }
        .option-button:hover {
            border-color: #000;
            background: #f9fafb;
        }
        .option-button.selected {
            border-color: #000;
            background: #000;
            color: white;
        }
        .input-clean {
            border: none;
            border-bottom: 1px solid #e5e7eb;
            background: transparent;
            outline: none;
            font-size: 18px;
            padding: 12px 0;
        }
        .input-clean:focus {
            border-bottom-color: #000;
        }
        .progress-dots {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }
        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }
        .progress-dot.active {
            background: #000;
        }
        .chat-input {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 20px;
        }
        .chat-messages {
            padding-bottom: 100px;
        }
    </style>
</head>
<body class="bg-white min-h-screen">
    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="progress-dots">
        <div class="progress-dot active"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
    </div>

    <!-- å¯¹è¯åŒºåŸŸ -->
    <div class="chat-messages max-w-2xl mx-auto px-6 py-12" id="messages">
        <!-- åˆå§‹æ¬¢è¿æ¶ˆæ¯ -->
        <div class="message mb-8">
            <div class="text-sm text-gray-400 mb-2">æ°¸å¿µ</div>
            <div class="text-lg text-gray-900 leading-relaxed">
                ä½ å¥½ï¼Œæˆ‘æ¥å¸®ä½ ä¸ºççˆ±çš„å®ƒåˆ›å»ºä¸€ä¸ªçºªå¿µé¡µé¢ã€‚
            </div>
        </div>
        
        <div class="message mb-8">
            <div class="text-sm text-gray-400 mb-2">æ°¸å¿µ</div>
            <div class="text-lg text-gray-900 leading-relaxed">
                è¯·å‘Šè¯‰æˆ‘ï¼Œå®ƒå«ä»€ä¹ˆåå­—ï¼Ÿ
            </div>
        </div>
    </div>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="chat-input">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-4">
                <input 
                    type="text" 
                    placeholder="è¾“å…¥åå­—..." 
                    class="input-clean flex-1"
                    id="currentInput"
                    autocomplete="off"
                />
                <button 
                    class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors disabled:bg-gray-300" 
                    onclick="submitAnswer()"
                    id="submitBtn"
                >
                    ç¡®å®š
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let answers = {};
        let isProcessing = false;

        const questions = [
            {
                id: 'petName',
                type: 'text',
                question: 'è¯·å‘Šè¯‰æˆ‘ï¼Œå®ƒå«ä»€ä¹ˆåå­—ï¼Ÿ',
                placeholder: 'è¾“å…¥åå­—...',
                validation: (value) => value.trim().length > 0
            },
            {
                id: 'petType',
                type: 'options',
                question: `å¾ˆå¥½å¬çš„åå­—ï¼${getCurrentAnswer('petName')}æ˜¯ä»€ä¹ˆåŠ¨ç‰©å‘¢ï¼Ÿ`,
                options: [
                    { value: 'dog', label: 'ç‹—ç‹— ğŸ•' },
                    { value: 'cat', label: 'çŒ«å’ª ğŸ±' },
                    { value: 'bird', label: 'é¸Ÿå„¿ ğŸ¦' },
                    { value: 'rabbit', label: 'å…”å­ ğŸ°' },
                    { value: 'hamster', label: 'ä»“é¼  ğŸ¹' },
                    { value: 'other', label: 'å…¶ä»–' }
                ]
            },
            {
                id: 'breed',
                type: 'text',
                question: `æ˜¯ä»€ä¹ˆå“ç§çš„${getAnimalName()}å‘¢ï¼Ÿ`,
                placeholder: 'ä¾‹å¦‚ï¼šé‡‘æ¯›ã€è‹±çŸ­ã€è™çš®é¹¦é¹‰...',
                optional: true
            },
            {
                id: 'color',
                type: 'options',
                question: `${getCurrentAnswer('petName')}æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ`,
                options: [
                    { value: 'black', label: 'é»‘è‰²' },
                    { value: 'white', label: 'ç™½è‰²' },
                    { value: 'brown', label: 'æ£•è‰²' },
                    { value: 'gray', label: 'ç°è‰²' },
                    { value: 'black-white', label: 'é»‘ç™½è‰²' },
                    { value: 'multicolor', label: 'å¤šè‰²' }
                ]
            },
            {
                id: 'gender',
                type: 'options',
                question: `${getCurrentAnswer('petName')}æ˜¯ç”·å­©è¿˜æ˜¯å¥³å­©ï¼Ÿ`,
                options: [
                    { value: 'male', label: 'ç”·å­© â™‚' },
                    { value: 'female', label: 'å¥³å­© â™€' }
                ]
            },
            {
                id: 'birthDate',
                type: 'date',
                question: `${getCurrentAnswer('petName')}æ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ`,
                placeholder: 'å¤§æ¦‚æ—¶é—´å°±å¯ä»¥...'
            },
            {
                id: 'passingDate',
                type: 'date',
                question: 'å®ƒæ˜¯ä»€ä¹ˆæ—¶å€™ç¦»å¼€ä½ çš„ï¼Ÿ'
            },
            {
                id: 'personality',
                type: 'multiple',
                question: `æè¿°ä¸€ä¸‹${getCurrentAnswer('petName')}çš„æ€§æ ¼ç‰¹ç‚¹å§`,
                options: [
                    { value: 'playful', label: 'é¡½çš® ğŸ¾' },
                    { value: 'loyal', label: 'å¿ è¯š â¤ï¸' },
                    { value: 'gentle', label: 'æ¸©æŸ” ğŸ•Šï¸' },
                    { value: 'energetic', label: 'æ´»è·ƒ âš¡' },
                    { value: 'calm', label: 'å®‰é™ ğŸ˜Œ' },
                    { value: 'friendly', label: 'å‹å¥½ ğŸ˜Š' }
                ]
            },
            {
                id: 'memory',
                type: 'textarea',
                question: `æœ€åï¼Œåˆ†äº«ä¸€ä¸ªå…³äº${getCurrentAnswer('petName')}çš„ç‰¹åˆ«å›å¿†å§`,
                placeholder: 'å†™ä¸‹ä½ ä»¬ä¹‹é—´æœ€çè´µçš„å›å¿†...',
                optional: true
            },
            {
                id: 'creator',
                type: 'text',
                question: 'è¯·å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œè¿™æ ·æˆ‘å°±çŸ¥é“æ˜¯è°åˆ›å»ºäº†è¿™ä¸ªçºªå¿µé¡µé¢',
                placeholder: 'ä½ çš„åå­—...'
            }
        ];

        function getCurrentAnswer(key) {
            return answers[key] || '';
        }

        function getAnimalName() {
            const petType = answers.petType;
            const typeMap = {
                'dog': 'ç‹—ç‹—',
                'cat': 'çŒ«å’ª',
                'bird': 'é¸Ÿå„¿',
                'rabbit': 'å…”å­',
                'hamster': 'ä»“é¼ ',
                'other': 'å® ç‰©'
            };
            return typeMap[petType] || 'å® ç‰©';
        }

        function addMessage(sender, content, delay = 0) {
            setTimeout(() => {
                const messagesContainer = document.getElementById('messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message mb-8';
                messageDiv.innerHTML = `
                    <div class="text-sm text-gray-400 mb-2">${sender}</div>
                    <div class="text-lg text-gray-900 leading-relaxed">${content}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, delay);
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message mb-8 typing-indicator';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="text-sm text-gray-400 mb-2">æ°¸å¿µ</div>
                <div class="text-lg text-gray-500">æ­£åœ¨è¾“å…¥...</div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typing');
            if (typing) {
                typing.remove();
            }
        }

        function setupInput(question) {
            const inputContainer = document.querySelector('.chat-input .max-w-2xl');
            
            if (question.type === 'text' || question.type === 'date') {
                inputContainer.innerHTML = `
                    <div class="flex items-center gap-4">
                        <input 
                            type="${question.type === 'date' ? 'date' : 'text'}" 
                            placeholder="${question.placeholder || ''}" 
                            class="input-clean flex-1"
                            id="currentInput"
                            autocomplete="off"
                        />
                        <button 
                            class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors disabled:bg-gray-300" 
                            onclick="submitAnswer()"
                            id="submitBtn"
                        >
                            ç¡®å®š
                        </button>
                    </div>
                `;
            } else if (question.type === 'textarea') {
                inputContainer.innerHTML = `
                    <div class="space-y-4">
                        <textarea 
                            placeholder="${question.placeholder || ''}" 
                            class="w-full border-0 border-b border-gray-200 bg-transparent outline-none resize-none p-0 text-lg focus:border-black"
                            rows="3"
                            id="currentInput"
                        ></textarea>
                        <div class="flex justify-end gap-3">
                            ${question.optional ? '<button class="text-gray-500 text-sm hover:text-gray-700" onclick="skipQuestion()">è·³è¿‡</button>' : ''}
                            <button 
                                class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors" 
                                onclick="submitAnswer()"
                                id="submitBtn"
                            >
                                ç¡®å®š
                            </button>
                        </div>
                    </div>
                `;
            } else if (question.type === 'options' || question.type === 'multiple') {
                const buttonsHtml = question.options.map(option => `
                    <button 
                        class="option-button p-4 text-left w-full mb-3 ${question.type === 'multiple' ? 'multiple-option' : ''}" 
                        data-value="${option.value}"
                        onclick="${question.type === 'multiple' ? 'toggleMultipleOption' : 'selectOption'}(this)"
                    >
                        ${option.label}
                    </button>
                `).join('');
                
                inputContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="grid gap-2">
                            ${buttonsHtml}
                        </div>
                        ${question.type === 'multiple' ? `
                            <div class="flex justify-end">
                                <button 
                                    class="bg-black text-white px-6 py-3 text-sm hover:bg-gray-800 transition-colors" 
                                    onclick="submitMultipleAnswer()"
                                    id="submitBtn"
                                >
                                    ç¡®å®š
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            setTimeout(() => {
                const input = document.getElementById('currentInput');
                if (input && input.focus) {
                    input.focus();
                }
            }, 100);

            // å›è½¦æäº¤
            document.addEventListener('keypress', handleEnterKey);
        }

        function handleEnterKey(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                submitAnswer();
            }
        }

        function selectOption(button) {
            // æ¸…é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // é€‰ä¸­å½“å‰é€‰é¡¹
            button.classList.add('selected');
            
            // å»¶è¿Ÿæäº¤ï¼Œè®©ç”¨æˆ·çœ‹åˆ°é€‰ä¸­æ•ˆæœ
            setTimeout(() => {
                answers[questions[currentQuestion].id] = button.dataset.value;
                nextQuestion();
            }, 300);
        }

        function toggleMultipleOption(button) {
            button.classList.toggle('selected');
        }

        function submitMultipleAnswer() {
            const selectedOptions = Array.from(document.querySelectorAll('.multiple-option.selected'))
                .map(btn => btn.dataset.value);
            
            if (selectedOptions.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé€‰é¡¹');
                return;
            }
            
            answers[questions[currentQuestion].id] = selectedOptions;
            nextQuestion();
        }

        function submitAnswer() {
            if (isProcessing) return;
            
            const input = document.getElementById('currentInput');
            const value = input ? input.value.trim() : '';
            const question = questions[currentQuestion];
            
            if (!question.optional && (!value || value === '')) {
                alert('è¯·å¡«å†™å¿…å¡«ä¿¡æ¯');
                return;
            }
            
            if (question.validation && !question.validation(value)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆä¿¡æ¯');
                return;
            }
            
            answers[question.id] = value;
            
            // æ˜¾ç¤ºç”¨æˆ·çš„å›ç­”
            addMessage('ä½ ', value || '(è·³è¿‡)');
            
            nextQuestion();
        }

        function skipQuestion() {
            answers[questions[currentQuestion].id] = '';
            addMessage('ä½ ', '(è·³è¿‡)');
            nextQuestion();
        }

        function nextQuestion() {
            if (isProcessing) return;
            isProcessing = true;
            
            // ç§»é™¤è¾“å…¥äº‹ä»¶ç›‘å¬
            document.removeEventListener('keypress', handleEnterKey);
            
            currentQuestion++;
            
            // æ›´æ–°è¿›åº¦ç‚¹
            const dots = document.querySelectorAll('.progress-dot');
            if (dots[Math.floor(currentQuestion / 2)]) {
                dots[Math.floor(currentQuestion / 2)].classList.add('active');
            }
            
            if (currentQuestion >= questions.length) {
                // å®Œæˆæ‰€æœ‰é—®é¢˜
                showCompletion();
                return;
            }
            
            // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const question = questions[currentQuestion];
                let questionText = question.question;
                
                // åŠ¨æ€æ›¿æ¢é—®é¢˜ä¸­çš„å˜é‡
                questionText = questionText.replace(/\$\{getCurrentAnswer\('(\w+)'\)\}/g, (match, key) => {
                    return getCurrentAnswer(key);
                });
                questionText = questionText.replace(/\$\{getAnimalName\(\)\}/g, getAnimalName());
                
                addMessage('æ°¸å¿µ', questionText);
                
                setTimeout(() => {
                    setupInput(question);
                    isProcessing = false;
                }, 500);
            }, 1000);
        }

        function showCompletion() {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('æ°¸å¿µ', `è°¢è°¢ä½ åˆ†äº«å…³äº${getCurrentAnswer('petName')}çš„ç¾å¥½å›å¿†ã€‚`);
                
                setTimeout(() => {
                    addMessage('æ°¸å¿µ', 'ç°åœ¨æˆ‘å°†ä¸ºä½ åˆ›å»ºè¿™ä¸ªç‰¹åˆ«çš„çºªå¿µé¡µé¢...');
                    
                    // éšè—è¾“å…¥åŒºåŸŸ
                    document.querySelector('.chat-input').style.display = 'none';
                    
                    setTimeout(() => {
                        // æ˜¾ç¤ºå®Œæˆé¡µé¢æˆ–æäº¤è¡¨å•
                        console.log('æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼š', answers);
                        alert('çºªå¿µé¡µé¢åˆ›å»ºå®Œæˆï¼\n\næ”¶é›†åˆ°çš„ä¿¡æ¯å·²åœ¨æ§åˆ¶å°æ˜¾ç¤ºã€‚');
                    }, 2000);
                }, 1500);
            }, 1000);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupInput(questions[0]);
        });
    </script>
</body>
</html>